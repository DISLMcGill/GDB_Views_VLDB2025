CREATE VIEW AS V_IC2 MATCH p1=(p:Person)-[r1:PERSON_KNOWS_PERSON]-(friend:Person),p2 = (friend)<-[r2:POST_HAS_CREATOR_PERSON|COMMENT_HAS_CREATOR_PERSON]-(message:Post:Comment) WHERE p.id = 1129 AND message.creationDate <= 1322000000000 RETURN p2 ORDER BY message.creationDate DESC, message.id LIMIT 20
WITH VIEWS V_IC2 LOCAL MATCH p=(p1:Person)-[:POST_HAS_CREATOR_PERSON | COMMENT_HAS_CREATOR_PERSON]-(message) WHERE p IN V_IC2 RETURN p1, message
CREATE VIEW AS V_IC4 MATCH p1=(person:Person)-[:PERSON_KNOWS_PERSON]-(friend:Person)<-[:POST_HAS_CREATOR_PERSON]-(post:Post),p2=(post)-[:POST_HAS_TAG_TAG]->(tag:Tag) WHERE person.id = 1129 RETURN p2
WITH VIEWS V_IC4 GLOBAL MATCH p=(post:Post)-[:POST_HAS_TAG_TAG]->(tag:Tag) WHERE p IN V_IC4 WITH tag, CASE WHEN post.creationDate >= 1345000000000 AND post.creationDate < 1348000000000 THEN 1 ELSE 0 END AS valid, CASE WHEN post.creationDate < 1345000000000 THEN 1 ELSE 0 END AS inValid WITH tag, SUM(valid) AS postCount, SUM(inValid) AS inValidPostCount WHERE postCount > 0 AND inValidPostCount=0 RETURN tag ORDER BY postCount DESC LIMIT 10
CREATE VIEW AS V_IC5 MATCH (person:Person)-[:PERSON_KNOWS_PERSON*1..2]-(friend:Person) WHERE person.id = 933 RETURN friend
WITH VIEWS V_IC5 GLOBAL MATCH (friend:Person)<-[membership:FORUM_HAS_MEMBER]-(forum:Forum) WHERE friend IN V_IC5 AND membership.joinDate > 1322000000000 WITH forum as forum, COLLECT(friend) AS friends OPTIONAL MATCH (friend)<-[:POST_HAS_CREATOR_PERSON]-(post:Post)<-[:FORUM_CONTAINER_OF_POST]-(forum) WHERE friend IN friends WITH forum, COUNT(post) AS postCount RETURN forum.title AS forumName, postCount ORDER BY postCount DESC, forum.id LIMIT 20
CREATE VIEW AS V_IC6 MATCH (knownTag:Tag) WHERE knownTag.name="Muammar_Gaddafi" WITH knownTag MATCH (person:Person)-[:PERSON_KNOWS_PERSON*1..2]-(friend:Person) WHERE person.id= 1129 RETURN knownTag,friend
WITH VIEWS V_IC6 GLOBAL MATCH (post)-[:POST_HAS_CREATOR_PERSON]->(f:Person), (post)-[:POST_HAS_TAG_TAG]->(t:Tag), (post)-[:POST_HAS_TAG_TAG]->(tag:Tag) WHERE f IN V_IC6.friend AND t IN V_IC6.knownTag AND NOT t = tag WITH tag.name as tagName, COUNT(post) as postCount RETURN tagName, postCount ORDER BY postCount DESC, tagName LIMIT 10
CREATE VIEW AS V_IC8 MATCH p=(start:Person)<-[:POST_HAS_CREATOR_PERSON|COMMENT_HAS_CREATOR_PERSON]-(message)<-[:COMMENT_REPLY_OF_COMMENT|COMMENT_REPLY_OF_POST]-(comment:Comment), p2 = (comment)-[:COMMENT_HAS_CREATOR_PERSON]->(person:Person) WHERE start.id = 1129 RETURN p2
WITH VIEWS V_IC8 LOCAL MATCH p=(comment:Comment)-[:COMMENT_HAS_CREATOR_PERSON]->(person:Person) WHERE p IN V_IC8 RETURN person.id AS personId, person.firstName AS personFirstName, person.lastName AS personLastName, comment.creationDate AS commentCreationDate, comment.id AS commentId, comment.content AS commentContent ORDER BY commentCreationDate DESC, commentId LIMIT 20
CREATE VIEW AS V_IC12 MATCH (tag:Tag)-[:HAS_TYPE|TAGCLASS_IS_SUBCLASS_OF*0..]->(baseTagClass:TagClass) WHERE tag.name = "OfficeHolder" OR baseTagClass.name = "OfficeHolder" WITH COLLECT(tag.id) as tags MATCH p1=(p:Person)-[:PERSON_KNOWS_PERSON]-(friend:Person)<-[:COMMENT_HAS_CREATOR_PERSON]-(comment:Comment)-[:COMMENT_REPLY_OF_POST]->(post:Post)-[:POST_HAS_TAG_TAG]->(tag:Tag) WHERE p.id = 1129 AND tag.id IN tags RETURN p1
WITH VIEWS V_IC12 LOCAL MATCH p=(person)-[:PERSON_KNOWS_PERSON]-(friend)<-[:COMMENT_HAS_CREATOR_PERSON]-(comment)-[:COMMENT_REPLY_OF_POST]->(post)-[:POST_HAS_TAG_TAG]->(tag) WHERE p IN V_IC12 RETURN friend.id AS personId, friend.firstName AS personFirstName, friend.lastName AS personLastName, COLLECT(tag.name) AS tagNames, COUNT(comment) AS replyCount ORDER BY replyCount DESC, personId LIMIT 20
CREATE VIEW AS V_IS2 MATCH (p:Person)<-[:POST_HAS_CREATOR_PERSON|COMMENT_HAS_CREATOR_PERSON]-(message) WHERE p.id = 1129 RETURN message ORDER BY message.creationDate DESC, message.id LIMIT 10
WITH VIEWS V_IC12 LOCAL MATCH p=(person:Person)-[:PERSON_KNOWS_PERSON]-(friend:Person)<-[:COMMENT_HAS_CREATOR_PERSON]-(comment:Comment)-[:COMMENT_REPLY_OF_POST]->(post:Post)-[:POST_HAS_TAG_TAG]->(tag:Tag) WHERE p IN V_IC12 RETURN friend.id AS personId, friend.firstName AS personFirstName, friend.lastName AS personLastName, COLLECT(tag.name) AS tagNames, COUNT(comment) AS replyCount ORDER BY replyCount, personId LIMIT 20
CREATE VIEW AS V_IS3 MATCH p=(n:Person)-[r:PERSON_KNOWS_PERSON]-(friend:Person) WHERE n.id = 933 RETURN p
WITH VIEWS V_IS3 LOCAL MATCH p=(n)-[r:PERSON_KNOWS_PERSON]-(friend:Person) WHERE p IN V_IS3 AND n.id = 933 RETURN r.creationDate, friend.id AS personId, friend.firstName AS firstName, friend.lastName AS lastName
CREATE VIEW AS V_IS4 MATCH (m:Post) WHERE m.id = 1030792523231  RETURN m
WITH VIEWS V_IS4 LOCAL MATCH (n) WHERE n IN V_IS4 RETURN n.creationDate as messageCreationDate, coalesce(n.content, n.imageFile) as messageContent
CREATE VIEW AS V_IS5 MATCH (message)-[r1:COMMENT_HAS_CREATOR_PERSON|POST_HAS_CREATOR_PERSON]->(p:Person) WHERE message.id = 1030792523224 RETURN p
WITH VIEWS V_IS5 LOCAL MATCH (n) WHERE n IN V_IS5 RETURN n
CREATE VIEW AS V_IS7 MATCH (com:Comment)<-[r1:COMMENT_REPLY_OF_COMMENT]-(c:Comment)-[r2:COMMENT_HAS_CREATOR_PERSON]->(p:Person) WHERE com.id = 687194876501 OPTIONAL MATCH p1=(com)-[:COMMENT_HAS_CREATOR_PERSON]->(a:Person)-[r0:PERSON_KNOWS_PERSON]-(p)<-[r3]-(c)-[r4]->(com) RETURN p1
WITH VIEWS V_IS7 LOCAL MATCH p=(m)-[:COMMENT_HAS_CREATOR_PERSON|POST_HAS_CREATOR_PERSON]->(a:Person)-[r:PERSON_KNOWS_PERSON]-(reply)<-[r2]-(c:Comment)-[r3]->(m) WHERE p IN V_IS7.p1 RETURN reply.id AS replyAuthorId,reply.firstName AS replyAuthorFirstName,reply.lastName AS replyAuthorLastName,CASE r WHEN null THEN false ELSE true END AS replyAuthorKnowsOriginalMessageAuthor ORDER BY replyAuthorId
